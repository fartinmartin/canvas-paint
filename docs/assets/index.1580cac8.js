var He=Object.defineProperty;var Ge=(n,t,e)=>t in n?He(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var y=(n,t,e)=>(Ge(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();var ae=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},L={},Y={},G={};Object.defineProperty(G,"__esModule",{value:!0});var We=function(){function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}();function Ue(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}var Qe=function(){function n(t,e){Ue(this,n),this.x=t,this.y=e}return We(n,[{key:"update",value:function(e){this.x=e.x,this.y=e.y}},{key:"getDifferenceTo",value:function(e){return new n(this.x-e.x,this.y-e.y)}},{key:"getDistanceTo",value:function(e){var r=this.getDifferenceTo(e);return Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2))}}]),n}();G.default=Qe;Object.defineProperty(Y,"__esModule",{value:!0});var Je=function(){function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}(),Ve=G,he=Xe(Ve);function Xe(n){return n&&n.__esModule?n:{default:n}}function Ye(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}var Ke=1e-6,Ze=function(){function n(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=t.segments,r=e===void 0?50:e,i=t.iterationLimit,s=i===void 0?100:i;Ye(this,n),this.p1=new he.default,this.p2=new he.default,this.segments=r,this.iterationLimit=s}return Je(n,[{key:"drawToCanvas",value:function(e,r,i,s){this.p1.update(r),this.p2.update(i);var a=this.p1.x>this.p2.x,o=a?this.p2:this.p1,l=a?this.p1:this.p2,p=o.getDistanceTo(l),u=[],c=!0;if(p<s){var h=l.x-o.x;if(h>.01){var d=l.x-o.x,f=l.y-o.y,v=-this.getCatenaryParameter(d,f,s,this.iterationLimit),g=(v*Math.log((s+f)/(s-f))-d)*.5,x=v*Math.cosh(g/v),m=o.x-g,w=o.y-x;u=this.getCurve(v,o,l,m,w,this.segments),c=!1}else{var O=(o.x+l.x)*.5,_=(o.y+l.y+s)*.5;u=[[o.x,o.y],[O,_],[l.x,l.y]]}}else u=[[o.x,o.y],[l.x,l.y]];return c?this.drawLine(u,e):this.drawCurve(u,e),u}},{key:"getCatenaryParameter",value:function(e,r,i,s){for(var a=Math.sqrt(i*i-r*r)/e,o=Math.acosh(a)+1,l=-1,p=0;Math.abs(o-l)>Ke&&p<s;)l=o,o=o-(Math.sinh(o)-a*o)/(Math.cosh(o)-a),p++;return e/(2*o)}},{key:"getCurve",value:function(e,r,i,s,a,o){for(var l=[r.x,e*Math.cosh((r.x-s)/e)+a],p=i.x-r.x,u=o-1,c=0;c<u;c++){var h=r.x+p*(c+.5)/u,d=e*Math.cosh((h-s)/e)+a;l.push(h,d)}return l.push(i.x,e*Math.cosh((i.x-s)/e)+a),l}},{key:"drawLine",value:function(e,r){r.moveTo(e[0][0],e[0][1]),r.lineTo(e[1][0],e[1][1])}},{key:"drawCurve",value:function(e,r){var i=e.length*.5-1,s=e[2],a=e[3],o=[];r.moveTo(e[0],e[1]);for(var l=2;l<i;l++){var p=e[l*2],u=e[l*2+1],c=(p+s)*.5,h=(u+a)*.5;o.push([s,a,c,h]),r.quadraticCurveTo(s,a,c,h),s=p,a=u}return i=e.length,r.quadraticCurveTo(e[i-4],e[i-3],e[i-2],e[i-1]),o}}]),n}();Y.default=Ze;Object.defineProperty(L,"__esModule",{value:!0});L.Point=Oe=L.Catenary=void 0;var et=Y,tt=Ce(et),nt=G,rt=Ce(nt);function Ce(n){return n&&n.__esModule?n:{default:n}}var Oe=L.Catenary=tt.default;L.Point=rt.default;const T="canvas-paint-";function Te(){return Math.random().toString(36).substring(2,9)}class K{constructor(t,e,r){y(this,"canvas");y(this,"context");y(this,"id");this.root=t,this.className=e,this.options=r,this.canvas=this.createCanvas(e),this.context=this.canvas.getContext("2d"),this.canvas.id=this.id=Te(),this.canvas.width=(r==null?void 0:r.width)||this.canvas.width,this.canvas.height=(r==null?void 0:r.height)||this.canvas.height,this.setDPI()}createCanvas(t){const e=document.createElement("canvas");return e.classList.add(T+t),this.root.appendChild(e)}setDPI(t){const{width:e,height:r}=t||this.canvas.getBoundingClientRect();this.canvas.width=e*devicePixelRatio,this.canvas.height=r*devicePixelRatio,this.context.scale(devicePixelRatio,devicePixelRatio),this.canvas.style.width=e+"px",this.canvas.style.height=r+"px"}resize(t){this.setDPI(t)}get scale(){return this.root.clientWidth/this.options.width}clear(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}}class it extends K{constructor(e,r,i){super(e,"ui",i);y(this,"catenary",new Oe);this.root=e,this.brush=r,this.options=i}drawInterface(){var p,u,c,h,d,f,v,g,x,m,w,O,_,b,z,M,$,ne,re,ie,se,oe;const{ui:e}=this.options,r=(e==null?void 0:e.brush)===!1&&((p=e==null?void 0:e.pointer)==null?void 0:p.size)===0&&((u=e==null?void 0:e.chain)==null?void 0:u.width)===0&&((c=e==null?void 0:e.center)==null?void 0:c.size)===0;if((e==null?void 0:e.show)===!1||r)return;const i=this.brush.lazy.getPointerCoordinates(),s=this.brush.lazy.getBrushCoordinates();this.context.clearRect(0,0,this.canvas.width,this.canvas.height);const{x:a,y:o}=s,l=Math.PI*2;if((e==null?void 0:e.brush)===!0){this.context.beginPath(),this.context.fillStyle=this.brush.color;const P=this.brush.size*this.scale;this.brush.cap==="round"?this.context.arc(a,o,P/2,0,l,!0):this.context.rect(a-P/2,o-P/2,P,P),this.context.fill()}if(!((h=e==null?void 0:e.pointer)!=null&&h.size)||((d=e==null?void 0:e.pointer)==null?void 0:d.size)&&e.pointer.size>0){this.context.beginPath(),this.context.fillStyle=(v=(f=e==null?void 0:e.pointer)==null?void 0:f.color)!=null?v:"#000000";const P=((x=(g=e==null?void 0:e.pointer)==null?void 0:g.size)!=null?x:8)/2;this.context.arc(i.x,i.y,P,0,l,!0),this.context.fill()}if(this.brush.lazy.isEnabled()&&((m=e==null?void 0:e.chain)==null?void 0:m.width)&&e.chain.width>0){this.context.beginPath(),this.context.lineWidth=(O=(w=e==null?void 0:e.chain)==null?void 0:w.width)!=null?O:2,this.context.lineCap="round",this.context.setLineDash((b=(_=e==null?void 0:e.chain)==null?void 0:_.dash)!=null?b:[2,4]),this.context.strokeStyle=(M=(z=e==null?void 0:e.chain)==null?void 0:z.color)!=null?M:"#000000";const P=this.brush.lazy.radius/2;this.catenary.drawToCanvas(this.context,s,i,P),this.context.stroke()}if((ne=($=e==null?void 0:e.center)==null?void 0:$.size)==null||ne){this.context.beginPath(),this.context.fillStyle=(ie=(re=e==null?void 0:e.center)==null?void 0:re.color)!=null?ie:"#000000";const P=((oe=(se=e==null?void 0:e.center)==null?void 0:se.size)!=null?oe:4)/2;this.context.arc(a,o,P,0,l,!0),this.context.fill()}}}class Z{constructor(t,e,r,i){this.x=t,this.y=e,this.color=r,this.size=i}}function st(n,t){return{x:n.x+(t.x-n.x)/2,y:n.y+(t.y-n.y)/2}}function ot(n,t){let e=JSON.parse(JSON.stringify(n));const i=n.scale/t;return e.points=e.points.map(s=>({...s,size:s.size/i,x:s.x/i,y:s.y/i})),e}function at(n,t){return n=ht(n),n.filter((e,r)=>(r+1)%t)}function ht(n){return n.filter((t,e,r)=>e===0||JSON.stringify(t)!==JSON.stringify(r[e-1]))}function ce(n,t){return new Z(n.x,n.y,n.color,n.size*t)}function ue(n){return new Promise(t=>setTimeout(t,n))}var k=function(n){var t={};function e(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return n[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=n,e.c=t,e.d=function(r,i,s){e.o(r,i)||Object.defineProperty(r,i,{enumerable:!0,get:s})},e.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},e.t=function(r,i){if(i&1&&(r=e(r)),i&8||i&4&&typeof r=="object"&&r&&r.__esModule)return r;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:r}),i&2&&typeof r!="string")for(var a in r)e.d(s,a,function(o){return r[o]}.bind(null,a));return s},e.n=function(r){var i=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(i,"a",i),i},e.o=function(r,i){return Object.prototype.hasOwnProperty.call(r,i)},e.p="",e(e.s=0)}([function(n,t,e){e.r(t),e.d(t,"isSameColor",function(){return s}),e.d(t,"setColorAtPixel",function(){return i}),e.d(t,"getColorAtPixel",function(){return r}),e.d(t,"colorToRGBA",function(){return o}),e.d(t,"hex2RGBA",function(){return a});function r(u,c,h){var d=u.width,f=u.data,v=4*(h*d+c);if(f[v+3]===void 0)throw new Error("Invalid pixel coordinates: x="+c+"; y="+h);return{r:f[v],g:f[v+1],b:f[v+2],a:f[v+3]}}function i(u,c,h,d){var f=u.width,v=u.data,g=4*(d*f+h);if(v[g+3]===void 0)throw new Error("Invalid pixel coordinates. Cannot set color at: x="+h+"; y="+d);v[g+0]=c.r&255,v[g+1]=c.g&255,v[g+2]=c.b&255,v[g+3]=c.a&255}function s(u,c,h){return h===void 0&&(h=0),!(Math.abs(u.r-c.r)>h||Math.abs(u.g-c.g)>h||Math.abs(u.b-c.b)>h||Math.abs(u.a-c.a)>h)}function a(u,c){c===void 0&&(c=255);var h=u;if(u.indexOf("#")===0&&(h=u.slice(1)),h.length===3&&(h=h[0]+h[0]+h[1]+h[1]+h[2]+h[2]),h.length!==6)throw new Error("Invalid HEX color "+h+".");var d=parseInt(h.slice(0,2),16),f=parseInt(h.slice(2,4),16),v=parseInt(h.slice(4,6),16);return{r:d,g:f,b:v,a:c}}function o(u){if(u.indexOf("rgba")!==-1){var c=/rgba\(.*?([0-9]{1,3}).*?([0-9]{1,3}).*?([0-9]{1,3}).*?([0-9\.]{1,})/g.exec(u);c[0];var h=c[1],d=c[2],f=c[3],v=c[4];return{r:parseInt(h),g:parseInt(d),b:parseInt(f),a:Math.ceil(parseFloat(v)*255)}}else if(u.indexOf("rgb")!==-1){var g=/rgb\(.*?([0-9]{1,3}).*?([0-9]{1,3}).*?([0-9]{1,3})/g.exec(u);g[0];var h=g[1],d=g[2],f=g[3];return{r:parseInt(h),g:parseInt(d),b:parseInt(f),a:255}}else{if(u.indexOf("#")!==-1)return a(u);throw new Error("Unsupported color format. Please use CSS rgba, rgb, or HEX!")}}var l=function(){function u(c){this.collectModifiedPixels=!1,this.modifiedPixelsCount=0,this.modifiedPixels=new Set,this._tolerance=0,this._queue=[],this.imageData=c,this.isSameColor=s,this.setColorAtPixel=i,this.getColorAtPixel=r,this.colorToRGBA=o}return u.prototype.fill=function(c,h,d,f){this._newColor=this.colorToRGBA(c),this._replacedColor=this.getColorAtPixel(this.imageData,h,d),this._tolerance=f,!this.isSameColor(this._replacedColor,this._newColor,this._tolerance)&&(this.addToQueue([h,h,d,-1]),this.fillQueue())},u.prototype.addToQueue=function(c){this._queue.push(c)},u.prototype.popFromQueue=function(){return this._queue.length?this._queue.pop():null},u.prototype.isValidTarget=function(c){if(c!==null){var h=this.getColorAtPixel(this.imageData,c.x,c.y);return this.isSameColor(this._replacedColor,h,this._tolerance)}},u.prototype.fillLineAt=function(c,h){if(!this.isValidTarget({x:c,y:h}))return[-1,-1];this.setPixelColor(this._newColor,{x:c,y:h});for(var d=c,f=c,v=this.getPixelNeighbour("left",d,h);v&&this.isValidTarget(v);)this.setPixelColor(this._newColor,v),d=v.x,v=this.getPixelNeighbour("left",d,h);for(v=this.getPixelNeighbour("right",f,h);v&&this.isValidTarget(v);)this.setPixelColor(this._newColor,v),f=v.x,v=this.getPixelNeighbour("right",f,h);return[d,f]},u.prototype.fillQueue=function(){for(var c=this.popFromQueue();c;){for(var h=c[0],d=c[1],f=c[2],v=c[3],g=h;g!==-1&&g<=d;){var x=this.fillLineAt(g,f),m=x[0],w=x[1];m!==-1&&(m>=h&&w<=d&&v!==-1?(v<f&&f+1<this.imageData.height&&this.addToQueue([m,w,f+1,f]),v>f&&f>0&&this.addToQueue([m,w,f-1,f])):(f>0&&this.addToQueue([m,w,f-1,f]),f+1<this.imageData.height&&this.addToQueue([m,w,f+1,f]))),w===-1&&g<=d?g+=1:g=w+1}c=this.popFromQueue()}},u.prototype.setPixelColor=function(c,h){this.setColorAtPixel(this.imageData,c,h.x,h.y),this.modifiedPixelsCount++,this.collectModifiedPixels&&this.modifiedPixels.add(h.x+"|"+h.y)},u.prototype.getPixelNeighbour=function(c,h,d){h=h|0,d=d|0;var f;switch(c){case"right":f={x:h+1|0,y:d};break;case"left":f={x:h-1|0,y:d};break}return f.x>=0&&f.x<this.imageData.width?f:null},u}(),p=l;t.default=p}]);k===void 0&&console.error("esm-webpack-plugin: nothing exported!");const ct=k.default;k.isSameColor;const ut=k.setColorAtPixel;k.getColorAtPixel;k.colorToRGBA;k.hex2RGBA;function le(n,t,e){return Math.min(Math.max(n,e),t)}class lt extends Error{constructor(t){super(`Failed to parse color: "${t}"`)}}var D=lt;function ft(n){if(typeof n!="string")throw new D(n);if(n.trim().toLowerCase()==="transparent")return[0,0,0,0];let t=n.trim();t=mt.test(n)?pt(n):n;const e=gt.exec(t);if(e){const a=Array.from(e).slice(1);return[...a.slice(0,3).map(o=>parseInt(I(o,2),16)),parseInt(I(a[3]||"f",2),16)/255]}const r=yt.exec(t);if(r){const a=Array.from(r).slice(1);return[...a.slice(0,3).map(o=>parseInt(o,16)),parseInt(a[3]||"ff",16)/255]}const i=_t.exec(t);if(i){const a=Array.from(i).slice(1);return[...a.slice(0,3).map(o=>parseInt(o,10)),parseFloat(a[3]||"1")]}const s=bt.exec(t);if(s){const[a,o,l,p]=Array.from(s).slice(1).map(parseFloat);if(le(0,100,o)!==o)throw new D(n);if(le(0,100,l)!==l)throw new D(n);return[...wt(a,o,l),p||1]}throw new D(n)}function dt(n){let t=5381,e=n.length;for(;e;)t=t*33^n.charCodeAt(--e);return(t>>>0)%2341}const fe=n=>parseInt(n.replace(/_/g,""),36),vt="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((n,t)=>{const e=fe(t.substring(0,3)),r=fe(t.substring(3)).toString(16);let i="";for(let s=0;s<6-r.length;s++)i+="0";return n[e]=`${i}${r}`,n},{});function pt(n){const t=n.toLowerCase().trim(),e=vt[dt(t)];if(!e)throw new D(n);return`#${e}`}const I=(n,t)=>Array.from(Array(t)).map(()=>n).join(""),gt=new RegExp(`^#${I("([a-f0-9])",3)}([a-f0-9])?$`,"i"),yt=new RegExp(`^#${I("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),_t=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${I(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),bt=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,mt=/^[a-z]+$/i,de=n=>Math.round(n*255),wt=(n,t,e)=>{let r=e/100;if(t===0)return[r,r,r].map(de);const i=(n%360+360)%360/60,s=(1-Math.abs(2*r-1))*(t/100),a=s*(1-Math.abs(i%2-1));let o=0,l=0,p=0;i>=0&&i<1?(o=s,l=a):i>=1&&i<2?(o=a,l=s):i>=2&&i<3?(l=s,p=a):i>=3&&i<4?(l=a,p=s):i>=4&&i<5?(o=a,p=s):i>=5&&i<6&&(o=s,p=a);const u=r-s/2,c=o+u,h=l+u,d=p+u;return[c,h,d].map(de)};var Me={},q=ae&&ae.__assign||function(){return q=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},q.apply(this,arguments)};Object.defineProperty(Me,"__esModule",{value:!0});function xt(n){var t,e=[];for(var r in n){for(var i=n[r],s=[],a=0;a<i.length;a++)for(var o=0;o<(e.length||1);o++){var l=q(q({},e[o]),(t={},t[r]=i[a],t));s.push(l)}e=s}return e}var zt=Me.default=xt;function Ee(n){const t=ft(n);return{r:t[0],g:t[1],b:t[2],a:255/t[3]}}function Pt(n,t,e=0){return!(Math.abs(n.r-t.r)>e||Math.abs(n.g-t.g)>e||Math.abs(n.b-t.b)>e||Math.abs(n.a-t.a)>e)}function Ct({imageData:{width:n,height:t},modifiedPixels:e},r){const{canvas:i,context:s}=ve(n,t),a=Ee(r),o=s.getImageData(0,0,n,t);e.forEach(u=>{const[c,h]=u.split("|").map(Number);ut(o,a,c,h)}),s.putImageData(o,0,0);const l=ve(n,t);l.context.putImageData(o,0,0);const p=.125;return zt({x:[0,1,-1],y:[0,1,-1]}).forEach(u=>{s.drawImage(i,u.x*p,u.y*p)}),s.globalCompositeOperation="destination-out",s.drawImage(l.canvas,0,0),{canvas:i,imageData:o,original:l}}function ve(n,t){const e=document.createElement("canvas"),r=e.getContext("2d");return e.width=n,e.height=t,{canvas:e,context:r}}class ke extends K{constructor(t,e,r,i){super(t,e,i),this.root=t,this.className=e,this.brush=r,this.options=i}async draw(t,e){const r=ot(t,this.scale);if(r.mode==="clear")return this.clear();if(!e)r.mode!=="fill"?this.drawPath(r):this.drawFill(r);else{for(let i=0;i<r.points.length;i++){const s=JSON.parse(JSON.stringify(r));s.points=s.points.slice(0,i+1),r.mode!=="fill"?this.drawPath(s):this.drawFill(s),await ue(e)}return ue(e)}}setBrush(t,e){var u;const{mode:r,cap:i,join:s}=t,{size:a,color:o}=e,l=this.canvas.classList.contains(`${T}temp`);this.context.globalCompositeOperation=l||r!=="erase"?"source-over":"destination-out",this.context.lineWidth=a,this.context.lineCap=i,this.context.lineJoin=s;const p=(u=this.options.bgColor)!=null?u:"white";this.context.strokeStyle=r==="erase"?p:o,this.context.fillStyle=r==="erase"?p:o}drawPath(t){if(t.points.length&&t.points.length<2)return this.drawDot(t);if(t.points.length<2)return;let e=t.points[0],r=t.points[1];this.setBrush(t,e),this.context.moveTo(r.x,r.y),this.context.beginPath();for(let i=1,s=t.points.length;i<s;i++){const a=st(e,r);this.context.quadraticCurveTo(e.x,e.y,a.x,a.y),e=t.points[i],r=t.points[i+1]}this.context.stroke()}drawDot(t){const e=t.points[0],{cap:r}=t,{size:i}=e;this.setBrush(t,e),this.context.beginPath();const s=i/2;r==="round"&&this.context.arc(e.x,e.y,s,0,2*Math.PI),r!=="round"&&this.context.rect(e.x-s,e.y-s,i,i),this.context.fill()}drawFill(t){if(this.canvas.className===`${T}temp`)return;const e=this.root.querySelector(`.${T}artboard`);if(!e||!(e instanceof HTMLCanvasElement))return;const r=e.getContext("2d"),i=r.getImageData(0,0,e.width,e.height),{x:s,y:a,color:o}=t.points[0],l=Math.round(s*devicePixelRatio),p=Math.round(a*devicePixelRatio),u=new ct(i);u.isSameColor=Pt,u.colorToRGBA=Ee,u.collectModifiedPixels=!0,u.fill(o,l,p,this.brush.tolerance),r.putImageData(u.imageData,0,0);const c=Ct(u,o);r.drawImage(c.canvas,0,0,e.width/devicePixelRatio,e.height/devicePixelRatio)}}class Ot extends ke{constructor(t,e,r){super(t,"temp",e,r),this.root=t}}class Tt extends ke{constructor(t,e,r){super(t,"artboard",e,r),this.root=t}}class Mt extends K{constructor(t,e){super(t,"grid",e),this.root=t}}var E={},ee={},W={},U={};Object.defineProperty(U,"__esModule",{value:!0});function Et(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}var kt=function n(t,e){Et(this,n),this.x=t,this.y=e};U.default=kt;Object.defineProperty(W,"__esModule",{value:!0});var Rt=function(){function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}(),St=U,pe=$t(St);function $t(n){return n&&n.__esModule?n:{default:n}}function jt(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function Dt(n,t){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:n}function At(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}var Lt=function(n){At(t,n);function t(){return jt(this,t),Dt(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Rt(t,[{key:"update",value:function(r){this.x=r.x,this.y=r.y}},{key:"moveByAngle",value:function(r,i){var s=r+Math.PI/2;this.x=this.x+Math.sin(s)*i,this.y=this.y-Math.cos(s)*i}},{key:"equalsTo",value:function(r){return this.x===r.x&&this.y===r.y}},{key:"getDifferenceTo",value:function(r){return new pe.default(this.x-r.x,this.y-r.y)}},{key:"getDistanceTo",value:function(r){var i=this.getDifferenceTo(r);return Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2))}},{key:"getAngleTo",value:function(r){var i=this.getDifferenceTo(r);return Math.atan2(i.y,i.x)}},{key:"toObject",value:function(){return{x:this.x,y:this.y}}}]),t}(pe.default);W.default=Lt;Object.defineProperty(ee,"__esModule",{value:!0});var It=function(){function n(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}(),qt=W,ge=Bt(qt);function Bt(n){return n&&n.__esModule?n:{default:n}}function Ft(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}var Nt=30,Ht=function(){function n(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=t.radius,r=e===void 0?Nt:e,i=t.enabled,s=i===void 0?!0:i,a=t.initialPoint,o=a===void 0?{x:0,y:0}:a;Ft(this,n),this.radius=r,this._isEnabled=s,this.pointer=new ge.default(o.x,o.y),this.brush=new ge.default(o.x,o.y),this.angle=0,this.distance=0,this._hasMoved=!1}return It(n,[{key:"enable",value:function(){this._isEnabled=!0}},{key:"disable",value:function(){this._isEnabled=!1}},{key:"isEnabled",value:function(){return this._isEnabled}},{key:"setRadius",value:function(e){this.radius=e}},{key:"getRadius",value:function(){return this.radius}},{key:"getBrushCoordinates",value:function(){return this.brush.toObject()}},{key:"getPointerCoordinates",value:function(){return this.pointer.toObject()}},{key:"getBrush",value:function(){return this.brush}},{key:"getPointer",value:function(){return this.pointer}},{key:"getAngle",value:function(){return this.angle}},{key:"getDistance",value:function(){return this.distance}},{key:"brushHasMoved",value:function(){return this._hasMoved}},{key:"update",value:function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=r.both,s=i===void 0?!1:i;return this._hasMoved=!1,this.pointer.equalsTo(e)&&!s?!1:(this.pointer.update(e),s?(this._hasMoved=!0,this.brush.update(e),!0):(this._isEnabled?(this.distance=this.pointer.getDistanceTo(this.brush),this.angle=this.pointer.getAngleTo(this.brush),this.distance>this.radius&&(this.brush.moveByAngle(this.angle,this.distance-this.radius),this._hasMoved=!0)):(this.distance=0,this.angle=0,this.brush.update(e),this._hasMoved=!0),!0))}}]),n}();ee.default=Ht;Object.defineProperty(E,"__esModule",{value:!0});E.LazyPoint=E.Point=Re=E.LazyBrush=void 0;var Gt=ee,Wt=te(Gt),Ut=U,Qt=te(Ut),Jt=W,Vt=te(Jt);function te(n){return n&&n.__esModule?n:{default:n}}var Re=E.LazyBrush=Wt.default;E.Point=Qt.default;E.LazyPoint=Vt.default;class Se{constructor(){y(this,"_listeners",[])}on(t,e){return this._listeners.push({event:t,callback:e}),()=>this._listeners=this._listeners.filter(r=>!(r.event===t&&r.callback===e))}dispatch(t,e){this._listeners.filter(r=>r.event===t).forEach(({callback:r})=>r(e))}removeAllListeners(){this._listeners=[]}}function Xt(){return"ontouchstart"in window.document}function ye(n,t){let e,r;Xt()?(e=n.touches[0].pageX,r=n.touches[0].pageY):(e=n.pageX,r=n.pageY);const i=t.getBoundingClientRect(),s={left:i.left+window.pageXOffset,top:i.top+window.pageYOffset};return{x:e-s.left,y:r-s.top}}class Yt{constructor(t,e){y(this,"events",new Se);y(this,"_isDrawing",!1);y(this,"_size");y(this,"_color");y(this,"_mode");y(this,"_cap");y(this,"_join");y(this,"_tolerance");y(this,"_lazy");var r,i,s,a,o,l,p,u,c,h,d,f,v,g,x,m,w,O;this.root=t,this._lazy=new Re({radius:(i=(r=e.lazy)==null?void 0:r.radius)!=null?i:0,enabled:(a=(s=e.lazy)==null?void 0:s.enabled)!=null?a:!0,initialPoint:(l=(o=e.lazy)==null?void 0:o.initialPoint)!=null?l:{x:0,y:0}}),this._size=(u=(p=e.brush)==null?void 0:p.size)!=null?u:5,this._color=(h=(c=e.brush)==null?void 0:c.color)!=null?h:"#ffaa00",this._mode=(f=(d=e.brush)==null?void 0:d.mode)!=null?f:"draw",this._cap=(g=(v=e.brush)==null?void 0:v.cap)!=null?g:"round",this._join=(m=(x=e.brush)==null?void 0:x.join)!=null?m:"round",this._tolerance=(O=(w=e.brush)==null?void 0:w.tolerance)!=null?O:30,this.root.addEventListener("mousemove",_=>this.handleMove(_)),this.root.addEventListener("mousedown",_=>this.handleDown(_)),this.root.addEventListener("mouseup",_=>this.handleUp(_)),this.root.addEventListener("mouseleave",_=>this.handleLeave(_)),this.root.addEventListener("touchmove",_=>this.handleMove(_)),this.root.addEventListener("touchstart",_=>this.handleDown(_)),this.root.addEventListener("touchend",_=>this.handleUp(_)),this.root.addEventListener("touchcancel",_=>this.handleLeave(_))}get isDrawing(){return this._isDrawing}get size(){return this._size}set size(t){t>0&&(this._size=t),this.events.dispatch("brushUpdate",this.payload)}get color(){return this._color}set color(t){this._color=t,this.events.dispatch("brushUpdate",this.payload)}get mode(){return this._mode}set mode(t){this._mode=t,this.events.dispatch("brushUpdate",this.payload)}get cap(){return this._cap}set cap(t){this._cap=t,this.events.dispatch("brushUpdate",this.payload)}get join(){return this._join}set join(t){this._join=t,this.events.dispatch("brushUpdate",this.payload)}get tolerance(){return this._tolerance}set tolerance(t){this._tolerance=t,this.events.dispatch("brushUpdate",this.payload)}get lazy(){return this._lazy}get point(){const{x:t,y:e}=this._lazy.brush.toObject();return new Z(t,e,this.color,this.size)}get payload(){return{isDrawing:this.isDrawing,mode:this.mode,cap:this.cap,point:this.point}}handleMove(t){t.preventDefault();const e=ye(t,this.root);this._lazy.update(e),this.events.dispatch("move",this.payload)}handleDown(t){t.preventDefault();const e=ye(t,this.root);this._lazy.update(e),this._isDrawing=!0,this.events.dispatch("down",this.payload)}handleUp(t){t.preventDefault(),this._isDrawing=!1,this.events.dispatch("up",this.payload)}handleLeave(t){t.preventDefault(),this.events.dispatch("leave",this.payload),this._isDrawing=!1}}class $e{constructor(t,e="draw",r=1,i="round",s="round",a){this.points=t,this.mode=e,this.scale=r,this.cap=i,this.join=s,this.tolerance=a}}class Kt{constructor(t=[]){y(this,"_stack",[]);y(this,"_redo",[]);this._state=t,this._stack.push(JSON.stringify(this._state))}get state(){const t=this._stack[this._stack.length-1];return JSON.parse(t)}reset(){this._stack=["[]"],this._redo=[]}execute(t){const e=t.execute(this.state),r=JSON.stringify(e);this._stack.push(r),this._redo=[]}undo(){this.canUndo&&this._redo.push(this._stack.pop())}redo(){this.canRedo&&this._stack.push(this._redo.pop())}get canUndo(){return this._stack.length>1}get canRedo(){return this._redo.length>=1}}class je{}class _e extends je{constructor(t){super(),this._value=t}execute(t){return t.push(this._value),t}}class be extends je{constructor(){super()}execute(t){const e=[new Z(0,0,"transparent",0)],r=new $e(e,"clear",1,"round","round",0);return t.push(r),t}}function Zt(n,t){const e=t+"base-styles",r=De(e),i=()=>r.sheet.cssRules.length;return C(r.sheet,`.${n} { display: grid; }`,0),C(r.sheet,`.${n} { overflow: hidden; }`,i()),C(r.sheet,`.${n} > canvas { grid-area: 1 / 1; }`,i()),C(r.sheet,`.${n} > canvas[class*="ui"] { z-index: 80 }`,i()),C(r.sheet,`.${n} > canvas[class*="temp"] { z-index: 60 }`,i()),C(r.sheet,`.${n} > canvas[class*="artboard"] { z-index: 40 }`,i()),C(r.sheet,`.${n} > canvas[class*="grid"] { z-index: 20 }`,i()),r.sheet}function me(n,t){const e=De(n);return C(e.sheet,`[data-${T}id="${n}"] { background: ${t.bgColor}; }`,0),C(e.sheet,`[data-${T}id="${n}"] { max-width: ${t.width}px; max-height: ${t.height}px; }`,1),C(e.sheet,`[data-${T}id="${n}"] { aspect-ratio: ${t.width} / ${t.height}; }`,2),e.sheet}function De(n){var i;const t=document.getElementById(n);if(t&&t instanceof HTMLStyleElement)return t;const e=document.createElement("style");e.id=n;const r=(i=document.styleSheets[0])==null?void 0:i.ownerNode;return document.head.insertBefore(e,r),e}function C(n,t,e){n.cssRules.item(e)&&n.deleteRule(e),n.insertRule(t,e)}var Ae=function(){if(typeof Map<"u")return Map;function n(t,e){var r=-1;return t.some(function(i,s){return i[0]===e?(r=s,!0):!1}),r}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(e){var r=n(this.__entries__,e),i=this.__entries__[r];return i&&i[1]},t.prototype.set=function(e,r){var i=n(this.__entries__,e);~i?this.__entries__[i][1]=r:this.__entries__.push([e,r])},t.prototype.delete=function(e){var r=this.__entries__,i=n(r,e);~i&&r.splice(i,1)},t.prototype.has=function(e){return!!~n(this.__entries__,e)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,r){r===void 0&&(r=null);for(var i=0,s=this.__entries__;i<s.length;i++){var a=s[i];e.call(r,a[1],a[0])}},t}()}(),V=typeof window<"u"&&typeof document<"u"&&window.document===document,B=function(){return typeof global<"u"&&global.Math===Math?global:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")()}(),en=function(){return typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(B):function(n){return setTimeout(function(){return n(Date.now())},1e3/60)}}(),tn=2;function nn(n,t){var e=!1,r=!1,i=0;function s(){e&&(e=!1,n()),r&&o()}function a(){en(s)}function o(){var l=Date.now();if(e){if(l-i<tn)return;r=!0}else e=!0,r=!1,setTimeout(a,t);i=l}return o}var rn=20,sn=["top","right","bottom","left","width","height","size","weight"],on=typeof MutationObserver<"u",an=function(){function n(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=nn(this.refresh.bind(this),rn)}return n.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},n.prototype.removeObserver=function(t){var e=this.observers_,r=e.indexOf(t);~r&&e.splice(r,1),!e.length&&this.connected_&&this.disconnect_()},n.prototype.refresh=function(){var t=this.updateObservers_();t&&this.refresh()},n.prototype.updateObservers_=function(){var t=this.observers_.filter(function(e){return e.gatherActive(),e.hasActive()});return t.forEach(function(e){return e.broadcastActive()}),t.length>0},n.prototype.connect_=function(){!V||this.connected_||(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),on?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},n.prototype.disconnect_=function(){!V||!this.connected_||(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},n.prototype.onTransitionEnd_=function(t){var e=t.propertyName,r=e===void 0?"":e,i=sn.some(function(s){return!!~r.indexOf(s)});i&&this.refresh()},n.getInstance=function(){return this.instance_||(this.instance_=new n),this.instance_},n.instance_=null,n}(),Le=function(n,t){for(var e=0,r=Object.keys(t);e<r.length;e++){var i=r[e];Object.defineProperty(n,i,{value:t[i],enumerable:!1,writable:!1,configurable:!0})}return n},S=function(n){var t=n&&n.ownerDocument&&n.ownerDocument.defaultView;return t||B},Ie=Q(0,0,0,0);function F(n){return parseFloat(n)||0}function we(n){for(var t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];return t.reduce(function(r,i){var s=n["border-"+i+"-width"];return r+F(s)},0)}function hn(n){for(var t=["top","right","bottom","left"],e={},r=0,i=t;r<i.length;r++){var s=i[r],a=n["padding-"+s];e[s]=F(a)}return e}function cn(n){var t=n.getBBox();return Q(0,0,t.width,t.height)}function un(n){var t=n.clientWidth,e=n.clientHeight;if(!t&&!e)return Ie;var r=S(n).getComputedStyle(n),i=hn(r),s=i.left+i.right,a=i.top+i.bottom,o=F(r.width),l=F(r.height);if(r.boxSizing==="border-box"&&(Math.round(o+s)!==t&&(o-=we(r,"left","right")+s),Math.round(l+a)!==e&&(l-=we(r,"top","bottom")+a)),!fn(n)){var p=Math.round(o+s)-t,u=Math.round(l+a)-e;Math.abs(p)!==1&&(o-=p),Math.abs(u)!==1&&(l-=u)}return Q(i.left,i.top,o,l)}var ln=function(){return typeof SVGGraphicsElement<"u"?function(n){return n instanceof S(n).SVGGraphicsElement}:function(n){return n instanceof S(n).SVGElement&&typeof n.getBBox=="function"}}();function fn(n){return n===S(n).document.documentElement}function dn(n){return V?ln(n)?cn(n):un(n):Ie}function vn(n){var t=n.x,e=n.y,r=n.width,i=n.height,s=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,a=Object.create(s.prototype);return Le(a,{x:t,y:e,width:r,height:i,top:e,right:t+r,bottom:i+e,left:t}),a}function Q(n,t,e,r){return{x:n,y:t,width:e,height:r}}var pn=function(){function n(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=Q(0,0,0,0),this.target=t}return n.prototype.isActive=function(){var t=dn(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},n.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},n}(),gn=function(){function n(t,e){var r=vn(e);Le(this,{target:t,contentRect:r})}return n}(),yn=function(){function n(t,e,r){if(this.activeObservations_=[],this.observations_=new Ae,typeof t!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=e,this.callbackCtx_=r}return n.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof S(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)||(e.set(t,new pn(t)),this.controller_.addObserver(this),this.controller_.refresh())}},n.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(!(typeof Element>"u"||!(Element instanceof Object))){if(!(t instanceof S(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;!e.has(t)||(e.delete(t),e.size||this.controller_.removeObserver(this))}},n.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},n.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(e){e.isActive()&&t.activeObservations_.push(e)})},n.prototype.broadcastActive=function(){if(!!this.hasActive()){var t=this.callbackCtx_,e=this.activeObservations_.map(function(r){return new gn(r.target,r.broadcastRect())});this.callback_.call(t,e,t),this.clearActive()}},n.prototype.clearActive=function(){this.activeObservations_.splice(0)},n.prototype.hasActive=function(){return this.activeObservations_.length>0},n}(),qe=typeof WeakMap<"u"?new WeakMap:new Ae,Be=function(){function n(t){if(!(this instanceof n))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var e=an.getInstance(),r=new yn(t,e,this);qe.set(this,r)}return n}();["observe","unobserve","disconnect"].forEach(function(n){Be.prototype[n]=function(){var t;return(t=qe.get(this))[n].apply(t,arguments)}});var _n=function(){return typeof B.ResizeObserver<"u"?B.ResizeObserver:Be}(),bn=typeof global=="object"&&global&&global.Object===Object&&global;const mn=bn;var wn=typeof self=="object"&&self&&self.Object===Object&&self,xn=mn||wn||Function("return this")();const Fe=xn;var zn=Fe.Symbol;const N=zn;var Ne=Object.prototype,Pn=Ne.hasOwnProperty,Cn=Ne.toString,j=N?N.toStringTag:void 0;function On(n){var t=Pn.call(n,j),e=n[j];try{n[j]=void 0;var r=!0}catch{}var i=Cn.call(n);return r&&(t?n[j]=e:delete n[j]),i}var Tn=Object.prototype,Mn=Tn.toString;function En(n){return Mn.call(n)}var kn="[object Null]",Rn="[object Undefined]",xe=N?N.toStringTag:void 0;function Sn(n){return n==null?n===void 0?Rn:kn:xe&&xe in Object(n)?On(n):En(n)}function $n(n){return n!=null&&typeof n=="object"}var jn="[object Symbol]";function Dn(n){return typeof n=="symbol"||$n(n)&&Sn(n)==jn}var An=/\s/;function Ln(n){for(var t=n.length;t--&&An.test(n.charAt(t)););return t}var In=/^\s+/;function qn(n){return n&&n.slice(0,Ln(n)+1).replace(In,"")}function X(n){var t=typeof n;return n!=null&&(t=="object"||t=="function")}var ze=0/0,Bn=/^[-+]0x[0-9a-f]+$/i,Fn=/^0b[01]+$/i,Nn=/^0o[0-7]+$/i,Hn=parseInt;function Pe(n){if(typeof n=="number")return n;if(Dn(n))return ze;if(X(n)){var t=typeof n.valueOf=="function"?n.valueOf():n;n=X(t)?t+"":t}if(typeof n!="string")return n===0?n:+n;n=qn(n);var e=Fn.test(n);return e||Nn.test(n)?Hn(n.slice(2),e?2:8):Bn.test(n)?ze:+n}var Gn=function(){return Fe.Date.now()};const J=Gn;var Wn="Expected a function",Un=Math.max,Qn=Math.min;function Jn(n,t,e){var r,i,s,a,o,l,p=0,u=!1,c=!1,h=!0;if(typeof n!="function")throw new TypeError(Wn);t=Pe(t)||0,X(e)&&(u=!!e.leading,c="maxWait"in e,s=c?Un(Pe(e.maxWait)||0,t):s,h="trailing"in e?!!e.trailing:h);function d(b){var z=r,M=i;return r=i=void 0,p=b,a=n.apply(M,z),a}function f(b){return p=b,o=setTimeout(x,t),u?d(b):a}function v(b){var z=b-l,M=b-p,$=t-z;return c?Qn($,s-M):$}function g(b){var z=b-l,M=b-p;return l===void 0||z>=t||z<0||c&&M>=s}function x(){var b=J();if(g(b))return m(b);o=setTimeout(x,v(b))}function m(b){return o=void 0,h&&r?d(b):(r=i=void 0,a)}function w(){o!==void 0&&clearTimeout(o),p=0,r=l=i=o=void 0}function O(){return o===void 0?a:m(J())}function _(){var b=J(),z=g(b);if(r=arguments,i=this,l=b,z){if(o===void 0)return f(l);if(c)return clearTimeout(o),o=setTimeout(x,t),d(l)}return o===void 0&&(o=setTimeout(x,t)),a}return _.cancel=w,_.flush=O,_}function Vn(n,t,e=500){let{width:r,height:i}=n.getBoundingClientRect();new _n(Jn(([a])=>{const{width:o,height:l}=a.target.getBoundingClientRect();(~~o!==~~r||~~l!==~~i)&&(t(a),r=o,i=l)},e)).observe(n)}const H=class{constructor(t,e){y(this,"id",Te());y(this,"instanceStyles");y(this,"ui");y(this,"temp");y(this,"artboard");y(this,"grid");y(this,"brush");y(this,"history",new Kt);y(this,"events",new Se);y(this,"points",[]);this.root=t,this.options=e,this.root.classList.add(H.className),this.root.dataset.canvasPaintId=this.id,this.instanceStyles=me(this.id,e),Vn(this.root,r=>this.resize(r),e.debounce),this.brush=new Yt(t,e),this.ui=new it(t,this.brush,e),this.temp=new Ot(t,this.brush,e),this.artboard=new Tt(t,this.brush,e),this.grid=new Mt(t,e),this.addListeners()}addListeners(){this.brush.events.on("brushUpdate",()=>this.ui.drawInterface()),this.brush.events.on("move",()=>this.ui.drawInterface()),this.brush.events.on("move",e=>{e.isDrawing&&e.mode!=="fill"&&(this.points.push(ce(e.point,this.scale)),this.temp.draw(this.path),this.events.dispatch("draw",e))}),this.brush.events.on("down",e=>{e.isDrawing&&(this.points.push(ce(e.point,this.scale)),this.temp.draw(this.path),this.events.dispatch("start",e))}),this.brush.events.on("up",e=>{t.call(this),this.events.dispatch("end",e)}),this.brush.events.on("leave",e=>{e.isDrawing&&(t.call(this),this.events.dispatch("leave",e))});function t(){this.temp.clear(),this.artboard.draw(this.path),this.history.execute(new _e(this.path)),this.points=[]}}removeListeners(){this.brush.events.removeAllListeners(),this.events.removeAllListeners()}async resize(t){this.events.dispatch("resizing",()=>{});const e=t.target.clientWidth,r={width:e,height:e/this.aspectRatio};[this.ui,this.temp,this.artboard,this.grid].forEach(i=>{i.resize(r)}),await this.drawHistory(),this.events.dispatch("resized",()=>{})}get aspectRatio(){return this.options.width/this.options.height}get scale(){return this.root.clientWidth/this.options.width}get path(){const{mode:t,cap:e,join:r,tolerance:i}=this.brush,s=at(this.points,2);return new $e(s,t,this.scale,e,r,i)}undo(){!this.history.canUndo||(this.history.undo(),this.artboard.clear(),this.drawHistory())}redo(){!this.history.canRedo||(this.history.redo(),this.artboard.clear(),this.drawHistory())}clear(){this.artboard.clear(),this.temp.clear(),this.history.execute(new be),this.points=[]}destroy(){this.clear(),this.history.reset()}save(){return{width:this.options.width,height:this.options.height,bgColor:this.options.bgColor,paths:this.history.state,version:"0.0.0"}}async load({width:t,height:e,paths:r,bgColor:i},s){return this.destroy(),this.options.width=t,this.options.height=e,[this.ui,this.temp,this.artboard,this.grid].forEach(a=>{a.resize({width:t,height:e})}),me(this.id,{width:t,height:e,bgColor:i}),r.forEach(a=>{const o=a.mode==="clear"?new be:new _e(a);this.history.execute(o)}),this.drawHistory(s)}async drawHistory(t){if(this.events.dispatch("drawing",()=>{}),this.artboard.clear(),t){for(const e of this.history.state)await this.temp.draw(e,t),this.artboard.draw(e),this.temp.clear(),this.events.dispatch("drawingPath",()=>{});this.drawHistory()}else for(const e of this.history.state)await this.artboard.draw(e);this.events.dispatch("drawn",()=>{})}};let A=H;y(A,"className",T+"container"),y(A,"baseStyles",Zt(H.className,T));const Xn=document.getElementById("app"),R=new A(Xn,{width:400,height:400,bgColor:"#ffffff"});window.demo=R;R.events.on("resizing",()=>console.log("resizing"));R.events.on("resized",()=>console.log("resized"));R.events.on("start",()=>console.log("start"));R.events.on("draw",()=>console.log("draw"));R.events.on("end",()=>console.log("end"));R.events.on("leave",()=>console.log("leave"));
